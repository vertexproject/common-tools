description: Run unit tests with pytest

parameters:
  args:
    type: string
    default: "-v -s -rs --durations 6 --maxfail 6 -p no:logging"

  extra_args:
    type: string
    default: ""

  coverage_args:
    type: string
    default: ""

  use_venv:
    type: boolean
    default: true

  tests:
    type: string
    default: ""

steps:
  - when:
      condition: << parameters.use_venv >>
      steps:
        - run:
            name: Run pytest
            command: |
              . venv/bin/activate
              python3 -m pytest << parameters.args >> << parameters.extra_args >> << parameters.coverage_args >> << parameters.tests >>

  - unless:
      condition: << parameters.use_venv >>
      steps:
        - run:
            name: Run pytest
            command: |
                python3 -m pytest << parameters.args >> << parameters.extra_args >> << parameters.coverage_args >> << parameters.tests >>
